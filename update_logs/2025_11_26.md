# 修改日志

## 1. MoveType 枚举修改（1546-1587行）

添加 `Swim`、`Leap`、`Trapped` 三种特别走法，分别对应：
- **Swim**：老鼠过河
- **Leap**：狮虎跳河
- **Trapped**：兽穴受击即死

## 2. Move 类修改（1628-1713行）

对 `Move` 类做相应修改，支持上述三种特别走法。

## 3. CompressedMove 设计（1730行）

### 设计格式

```cpp
// 2 bits for move type
// 6 bits for from square
// 6 bits for to square
```

### 说明

- 16 位（2 字节）只使用其中 14 位
- 用 6 位代表棋盘，需要做 8 位到 6 位的辅助转换
- **备选方案**：
  - 将 6 位升级为 7 位
  - 保留 8 位（会导致压缩数从 2 字节到 4 字节，可能影响计算效率）

## 4. CompressedReverseMove 设计（1964行）

### 原 m_oldState 的位布局（16 位）

从高位到低位：

| 位范围 | 字段 | 掩码 | 提取方式 |
|--------|------|------|----------|
| 15-12（4 位） | `capturedPiece`（被吃棋子） | `pieceMask = 0b1111`（4 位） | `m_oldState >> 11` |
| 11-8（4 位） | `oldCastlingRights`（走子前的王车易位权限） | `castlingRightsMask = 0b1111`（4 位） | `(m_oldState >> 7) & castlingRightsMask` |
| 7-1（7 位） | `oldEpSquare`（走子前的过路兵格） | `squareMask = 0b1111111`（7 位，可表示 `Square::none()`） | `m_oldState & squareMask` |
| 0 | 未使用 | - | - |

### 现设计思路（未完成）

从高位到低位：

| 位范围 | 字段 | 掩码 | 提取方式 |
|--------|------|------|----------|
| 15-11（5 位） | `capturedPiece`（被吃棋子） | `pieceMask = 0b1111`（4 位） | `m_oldState >> 11` |
| 10-8（3 位） | `TrapOrder`（落入陷阱的标号） | `TrapOrderMask = 0b111`（3 位） | `(m_oldState >> 7) & TrapOrderMask` |
| 7-1（7 位） | `oldEpSquare`（走子前的过路兵格） | `squareMask = 0b1111111`（7 位，可表示 `Square::none()`） | `m_oldState & squareMask` |
| 0 | 未使用 | - | - |

或者需要对每个陷阱（6个，三位表示）做标记，做Reverse操作的时候能够发现是哪个陷阱中的棋子被吃了