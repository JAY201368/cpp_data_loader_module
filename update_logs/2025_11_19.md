# 修改日志

## I. Piece 和 PieceType 棋子类（643-874行）

修改 `Piece` 和 `PieceType` 及其对应的 `EnumTraits`。

## II. File 和 Rank 棋盘行列定义（971-1079行）

修改棋盘的 `File` 和 `Rank` 组合：`8*8` → `7*9`。

## III. 棋盘编码和偏移量（1083-1491行）

**状态：未完成，需要重新设计编码格式**

### 问题描述

- 在 `1093` 行：`value(files + ranks * cardinality<File>())` 这里原有乘以 8 改为了 7，无法使用位运算 `<<3` 来获得 `rank`。
- 考虑将只有 3 位（0-7）的 `file` 改成 4 位。

## IV. Move 走法相关（1570-2131行）

**TODO：需要删除国际象棋特殊走法**

### 1. Move 结构体定义（1574-1617行）

- `MoveType::Normal` - 默认普通走子
- `Move::castle()` - 王车易位走子创建方法（**需删除**）
- `Move::enPassant()` - 吃过路兵走子创建方法（**需删除**）
- `Move::promotion()` - 升变走子创建方法（**需删除**）

### 2. 王车易位相关（1619-1630行）

### 3. CompressedMove 压缩走子（1634-1773行）

压缩走子数据结构。

### 4. ReverseMove 反向走子（1858-1901行）

- `1860` 行：包含 `Move move` - 存储原始走子（可能包含特殊走法）
- `1863` 行：`oldCastlingRights` - 存储易位权限（与易位相关）

### 5. CompressedReverseMove（1905-1977行）

压缩构造函数 - 压缩包含特殊走法的反向走子。

### 6. PackedReverseMove（1980-2092行）

解包反向走子，用于恢复某一步操作。

### 7. 比较器（2094-2131行）

- `2104` 行：比较 `lhs.type` - 走子类型比较（包括特殊走法）

### TODO

需要自己设计斗兽棋特殊走法：

- 老鼠过河
- 狮虎跳河
- 兽穴受击即死